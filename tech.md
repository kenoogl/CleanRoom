# Tech Steering: cleanroom-simulator

## 技術スタック
- **言語**: Julia 1.10+ (高性能数値計算と開発効率の両立)
- **並列化**: `FLoops.jl` (スレッド並列の抽象化、将来的なバックエンド変更への柔軟性)
- **行列演算**: `LinearAlgebra.jl` (標準ライブラリの活用)
- **データ形式**: `JSON3.jl` (高速なパラメータ読込)
- **可視化**: `CairoMakie.jl` (Package Extensionsによる遅延ロード、高品質な静的画像出力)

## 開発原則
- **型安全性の確保**: 物理量や設定値には適切な構造体（`struct`）を定義し、多重ディスパッチを活用する。
- **パフォーマンス最適化**: 内側ループでのメモリ確保を避け、`@simd` や `@inbounds` を適切に使用する。
- **モジュール化**: 物理モデル（対流、拡散、乱流）と数値解法（ポアソンソルバー、時間積分）を分離し、交換可能にする。
- **無次元化計算**: 内部計算はすべて無次元量で行い、入出力時のみ有次元変換を行うことで数値的安定性を高める。

## コーディング規約
- **命名規則**: 変数・関数名はスネークケース（`u_star`, `compute_flux`）、型名はパスカルケース（`CFDBuffers`）を基本とする。
- **インデックス**: Juliaの標準に従い1オリジンとする。
- **メモリ管理**: 大規模な配列は `WorkBuffers` パターンで一括管理し、再利用する。

## 数値スキームの決定事項
- **空間離散化**: 有限体積法、セルセンター配置。
- **対流項**: WENO3スキーム + Lax-Friedrichsフラックス分割。
- **時間積分**: Euler陽解法を基本とし、RK2/RK4をオプションでサポート。
- **圧力補正**: Fractional Step法。チェッカーボード不安定性防止のためセルフェイス内挿を実施。

## バイナリ仕様
- **エンディアン**: リトルエンディアン。
- **精度**: 内部計算は `Float64`、SPH出力は `Float32` (V-Isio互換)、チェックポイントは `Float64`。
- **レコードマーカー**: Fortran unformatted互換（4バイトのInt32でデータを挟む）。

## エラーハンドリング
- 入力検証は Fail-Fast 原則に従い、計算開始前に徹底的に行う。
- 計算中の発散（NaN/Inf, divMax超過）は即座に検出し、安全に停止してチェックポイントを保存する。